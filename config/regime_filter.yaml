# Regime Filter Configuration
#
# This file defines presets and default settings for the regime filter module.
# The regime filter detects market stress conditions and gates trading decisions
# to prevent over-trading during volatile periods (e.g., May 2021 crash).
#
# Problem Statement:
#   May 2021 had 1,285 trades vs FTX crash's 109 trades (12x over-trading)
#   May 2021 returned -36.79% while FTX returned +0.72%
#
# Solution:
#   Detect high-stress regimes using volatility and price action signals,
#   then reduce or halt trading during extreme conditions.

# =============================================================================
# REGIME DEFINITIONS
# =============================================================================
# NORMAL:   Standard market conditions - trade at full capacity
# ELEVATED: Increased stress detected - reduce position sizes and trade frequency
# EXTREME:  Crisis conditions - halt new trades, protect capital

# =============================================================================
# DEFAULT CONFIGURATION (MODERATE PRESET)
# =============================================================================
regime_filter:
  enabled: true
  preset: "moderate"  # Options: conservative, moderate, aggressive

  # Volatility detection settings
  # Uses rolling standard deviation of log returns
  volatility:
    lookback_hours: 24          # Window for current volatility measurement
    baseline_hours: 168         # Window for baseline (7 days)
    elevated_threshold: 1.5     # Current/baseline ratio triggers ELEVATED regime
    extreme_threshold: 2.5      # Current/baseline ratio triggers EXTREME regime

  # Price drop detection settings
  # Triggers regime change on significant drawdowns
  price_drop:
    lookback_hours: 24          # Lookback period for price change calculation
    elevated_threshold: -0.05   # -5% drop in 24h triggers ELEVATED
    extreme_threshold: -0.10    # -10% drop in 24h triggers EXTREME

  # Funding rate detection (crypto-specific)
  # Extreme funding rates indicate crowded positions
  funding:
    enabled: true
    extreme_threshold: 0.001    # |0.1%| per 8h triggers EXTREME regime

  # Trade limits per regime
  # Controls maximum trades allowed per day in each regime
  trade_limits:
    normal:
      max_trades_per_day: 50
      position_scale: 1.0       # Full position size
    elevated:
      max_trades_per_day: 10
      position_scale: 0.5       # Half position size
    extreme:
      max_trades_per_day: 0     # No new trades allowed
      position_scale: 0.0
      close_positions: false    # Set to true to close existing positions

  # Recovery settings
  # Controls how the system recovers from extreme regimes
  recovery:
    consecutive_drops_threshold: 3  # N consecutive -2% hours triggers EXTREME
    require_recovery_hours: 6       # Hours of calm before exiting EXTREME regime

# =============================================================================
# PRESET CONFIGURATIONS
# =============================================================================
# Use these as starting points and adjust based on your strategy's risk tolerance

presets:
  # CONSERVATIVE: Triggers regime changes earlier, more protective
  # Best for risk-averse strategies or when market uncertainty is high
  conservative:
    volatility:
      elevated_threshold: 1.3
      extreme_threshold: 2.0
    price_drop:
      elevated_threshold: -0.03
      extreme_threshold: -0.07
    trade_limits:
      elevated:
        max_trades_per_day: 5
        position_scale: 0.3
      extreme:
        max_trades_per_day: 0
        position_scale: 0.0

  # MODERATE: Balanced approach (default)
  # Suitable for most strategies, provides reasonable protection
  # without being overly restrictive
  moderate:
    volatility:
      elevated_threshold: 1.5
      extreme_threshold: 2.5
    price_drop:
      elevated_threshold: -0.05
      extreme_threshold: -0.10
    trade_limits:
      elevated:
        max_trades_per_day: 10
        position_scale: 0.5
      extreme:
        max_trades_per_day: 0
        position_scale: 0.0

  # AGGRESSIVE: Allows more trading during stress periods
  # Use only if your strategy has proven resilience to high volatility
  # or explicitly trades volatility
  aggressive:
    volatility:
      elevated_threshold: 2.0
      extreme_threshold: 3.0
    price_drop:
      elevated_threshold: -0.07
      extreme_threshold: -0.15
    trade_limits:
      elevated:
        max_trades_per_day: 20
        position_scale: 0.7
      extreme:
        max_trades_per_day: 5
        position_scale: 0.2

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================
logging:
  log_regime_changes: true      # Log when regime transitions occur
  log_blocked_trades: true      # Log when trades are blocked by filter
  save_regime_history: true     # Save regime history for post-analysis
  regime_history_file: "experiments/regime_history.csv"

# =============================================================================
# HISTORICAL PERIOD NOTES
# =============================================================================
# Reference: Walk-forward validation results with -2% stop-loss
#
# Period             | Original Return | Expected with Filter | Notes
# -------------------|-----------------|---------------------|------------------
# COVID Crash        | -1.03% ± 27.74% | ~0%                 | EXTREME regime expected
# May 2021 Crash     | -36.79% ± 37.48%| ~0%                 | EXTREME regime - no trading
# Luna/3AC Collapse  | +17.64% ± 19.08%| ~15-17%             | Minor filtering
# FTX Crash          | +0.72% ± 8.04%  | ~0-1%               | Minimal impact
# ETF Rally          | +17.04% ± 5.75% | ~16-17%             | Normal regime
# Full Holdout       | +25.43% ± 20.49%| ~20-25%             | Slight reduction
#
# Key insight: May 2021 had 1,285 trades vs FTX's 109. The regime filter
# should dramatically reduce May 2021 trades while preserving other periods.
